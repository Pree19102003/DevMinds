{% extends 'base.html' %}
{% block content %}

<div class="container mt-4">

    <h3>{{ resource.title }}</h3>
    <p class="text-muted">{{ resource.subject }}</p>

    <a href="{{ resource.file.url }}" class="btn btn-success mb-3">
        Download File
    </a>

    <hr>

    <h5>Average Rating ‚≠ê {{ resource.average_rating }}</h5>

    <!-- REVIEW FORM -->
    <h5 class="mt-3">Rate & Review</h5>
    <form method="post" action="{% url 'add_review' resource.id %}">
        {% csrf_token %}

        <select name="stars" class="form-select mb-2" required>
            <option value="">Select Stars</option>
            <option value="5" {% if user_rating and user_rating.stars == 5 %}selected{% endif %}>5</option>
            <option value="4" {% if user_rating and user_rating.stars == 4 %}selected{% endif %}>4</option>
            <option value="3" {% if user_rating and user_rating.stars == 3 %}selected{% endif %}>3</option>
            <option value="2" {% if user_rating and user_rating.stars == 2 %}selected{% endif %}>2</option>
            <option value="1" {% if user_rating and user_rating.stars == 1 %}selected{% endif %}>1</option>
        </select>

        <textarea name="comment" class="form-control mb-2"
        placeholder="Write review...">{{ user_comment.text|default:'' }}</textarea>

        <button class="btn btn-primary">Submit</button>

        {% if user_rating or user_comment %}
        <a href="{% url 'delete_review' resource.id %}" 
           class="btn btn-danger ms-2">
           Delete My Review
        </a>
        {% endif %}

    </form>

    <hr>

    <!-- REVIEWS LIST -->
    <h5>Reviews</h5>

    {% for c in resource.comments.all %}
    <div class="border rounded p-2 mb-2">
        <b>{{ c.user.username }}</b>
        <p>{{ c.text }}</p>
    </div>
    {% empty %}
    <p>No reviews yet</p>
    {% endfor %}

</div>

{% endblock %}
